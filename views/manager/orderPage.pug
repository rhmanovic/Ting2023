extends layout

block content
  .main.container
    h1 Order Detailed Page   


    .row
        h1.display-4.m-b-2 ITC Store
        
        .col.col-lg-2
            table.table.table-sm 
                //- thead
                    tr
                    th(scope='col') Proparty
                    th(scope='col') Value
                tbody
                    tr
                        th رقم الطلب
                        th :
                        td= `${orderData.orderNo}`
                        th
                    tr
                        th رقم الفاتورة
                        th :
                        td= `${orderData.invoice}`
                        td  
                          //if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                          a(href=`../editAny/Order/${orderData._id}/invoice//${orderData.invoice?orderData.invoice:"NaN"}/${typeof orderData.invoice}/orderPage`)
                              span.badge.text-bg-success
                                i.fa.fa-cog.p-1(aria-hidden='true')  
                    tr
                      th الهاتف
                      th :
                      td= `${orderData.mobile}`
                      td  
                        if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                          a(href=`../editAny/Order/${orderData._id}/mobile//${orderData.mobile?orderData.mobile:"NaN"}/${typeof orderData.mobile}/orderPage`)
                            span.badge.text-bg-success
                              i.fa.fa-cog.p-1(aria-hidden='true')

                    tr
                      th اسم العميل
                      th :
                      td= `${orderData.customerName}`
                      td  
                        if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                          a(href=`../editAny/Order/${orderData._id}/customerName//${orderData.customerName?orderData.customerName:"NaN"}/${typeof orderData.customerName}/orderPage`)
                            span.badge.text-bg-success
                              i.fa.fa-cog.p-1(aria-hidden='true')

                    tr
                      th العنوان
                      th :
                      td= `${orderData.address}`
                      td  
                        if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                          a(href=`../editAny/Order/${orderData._id}/address//${orderData.address?orderData.address:"NaN"}/${typeof orderData.address}/orderPage`)
                            span.badge.text-bg-success
                              i.fa.fa-cog.p-1(aria-hidden='true')

                    tr
                      th صورة الفاتورة
                      th :
                      if orderData.img
                        td 
                          a(href=`${orderData.img}`) رابط الصورة
                      else
                        td -
                      //td  
                        if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                      td 
                          a(href=`../uploadImage/Order/${orderData._id}/orderPage`)
                            span.badge.text-bg-success
                              i.fa.fa-upload.p-1(aria-hidden='true')

                    tr
                      th 
                      th 
                      th 
                      th
                        br
                        br
                    tr
                        th وسيلة الدفع 
                        th :
                        td= `${orderData.payment_method}`
                    tr
                        th حاله دفع اونلاين
                        th :
                        td= `${orderData.KentStatus}`
                    tr
                        th تأكيد الدفع
                        th :
                        td= `${orderData.KentStatusBackEnd}`
                    tr
                        th المتجر
                        th :
                        td= `${orderData.warehouse}`
                        td
                          if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                            a(href=`../editAny/Order/${orderData._id}/warehouse//${orderData.warehouse?orderData.warehouse:"NaN"}/${typeof orderData.warehouse}/orderPage`)
                              span.badge.text-bg-success
                                i.fa.fa-cog.p-1(aria-hidden='true')
                    tr
                        th paymentLog
                        th :
                        td= `${orderData.paymentLog}`
                        td
                          if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                            a(href=`../editAny/Order/${orderData._id}/paymentLog//${orderData.paymentLog?orderData.paymentLog:"NaN"}/${typeof orderData.paymentLog}/orderPage`)
                              span.badge.text-bg-success
                                i.fa.fa-cog.p-1(aria-hidden='true')
                    tr
                        th الحالة
                        th :
                        td= `${orderData.status}`
                        td
                          if (orderData.status != "completed" && orderData.status != "returned")
                            a(href=`../editAny/Order/${orderData._id}/status//${orderData.status?orderData.status:"NaN"}/${typeof orderData.status}/orderPage`)
                              span.badge.text-bg-success
                                i.fa.fa-cog.p-1(aria-hidden='true')


                    


                        





        if (orderData.status != "canceled") 
          .table-responsive
            table.table
                thead.table-secondary
                    tr
                    th #
                    th اسم المنتج
                    th اللون
                    th الكفاله
                    
                    //- th ID
                    th الكمية
                    th السعر
                    th الاجمالي
                tbody
                    - var x = 0 , total = 0
                    each product,index in orderData.productIDs
                        - x = x + 1
                        tr 
                            td= `${index+1}`
                            td= orderData.productNames[index]
                            td= orderData.variation[index]
                            td= orderData.warranty[index]
                            
                            //- td= orderData.productIDs[index]
                            //td= orderData.quantity[index]
                            td
                              form(method='POST' action='/manager/editOrder')
                                input.form-control(value=`${orderData.quantity[index]}` name='Value')
                                input.form-control(value=`${index}` name='index' type='hidden')
                                input.form-control(value=`quantity` name='field' type='hidden')
                                input.form-control(value=`${orderData._id}` name='orderID' type='hidden')
                                if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                                  button.btn.badge.text-bg-success.mx-2.my-1
                                    i.fa.fa-cog.p-1(aria-hidden='true')
    
                            td
                              form(method='POST' action='/manager/editOrder')
                                input.form-control(value=`${orderData.price[index]}` name='Value')
                                input.form-control(value=`${index}` name='index' type='hidden')
                                input.form-control(value=`price` name='field' type='hidden')
                                input.form-control(value=`${orderData._id}` name='orderID' type='hidden')
                                if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                                  button.btn.badge.text-bg-success.mx-2.my-1
                                    i.fa.fa-cog.p-1(aria-hidden='true')
    
                            td= (orderData.quantity[index] * orderData.price[index]).toFixed(3)
                            - total = total + orderData.price[index] * orderData.quantity[index] 
                
                tbody
                    th.table-secondary الخصم 
                      if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                       a(href=`../editAny/Order/${orderData._id}/discount//${orderData.discount?orderData.discount:"NaN"}/${typeof orderData.discount}/orderPage`)
                         span.badge.text-bg-success
                          i.fa.fa-cog.p-1(aria-hidden='true')
                    th.table-secondary
                      input.form-control(value=`${orderData.discount}` type='number' name='quantity' disabled)
                    th.table-secondary 
                tbody
                    th.table-secondary الشحن 
                      if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
                        a(href=`../editAny/Order/${orderData._id}/shippingCost//${orderData.shippingCost?orderData.shippingCost:"NaN"}/${typeof orderData.shippingCost}/orderPage`)
                          span.badge.text-bg-success
                            i.fa.fa-cog.p-1(aria-hidden='true')
                      
    
                    th.table-secondary
                      input.form-control(value=`${orderData.shippingCost}` type='number' name='quantity' disabled)
                    th.table-secondary 
                      
                tbody
                    th.table-secondary Total 
                    th.table-secondary= (total - orderData.discount + orderData.shippingCost).toFixed(3)
                    th.table-secondary 
            
    
          //if (orderData.status != "completed" && orderData.status != "returned" && orderData.status != "canceled")
            form(method='POST' action='/manager/AddProductToOrder')
              .row
                .col-sm
                    label(for='productID') product ID :
                    //- input.form-control(type='text' name='productID')
                    input.form-control(value=`${orderData._id}` type='hidden' name='orderID')
  
                 
                    
  
                     
  
  
  
                    select.form-select#orderProduct(name='productID' type='text')
                        each theProduct,index in productsData
                            option( value=`${theProduct._id}#${theProduct.qurain}#${theProduct.naseem}#${theProduct.price}`)= ` ${theProduct.SubProductId.length}  ${(theProduct.variant ) ? '' : '_______' } ${theProduct.productNo}: ${theProduct.name} || ${theProduct.brandName}  `
                .col-sm
                    label(for='quantity') Qurain :
                    input.form-control#qurainProductOrder(value=qurain disabled)
                .col-sm
                    label(for='quantity') Naseem :
                    input.form-control#naseemProductOrder(value=naseem disabled)
                .col-sm
                    label(for='quantity') Quantity :
                    input.form-control(value='1' type='number' name='quantity')
                .col-sm
                    label(for='quantity') Price :
                    input.form-control#PriceO(Value="0" type='number' step=".001" placeholder='0.000 KD' name='PriceO')
  
  
                
              
  
                //- .col-sm
                  label(for='status') Status :
                  select.form-select(name='status' type='text')
                    option(value='A') A
                    option(value='NA') NA
  
                .col-sm
                  label.text-white .
                  br
                  button.btn.btn-primary(type='submit') أضف
          //.row.mb-5
            
            if (orderData.status != "completed" && x !=0 && orderData.status != "returned" && orderData.status != "canceled")
                .col.mt-4
                    a(href=`../completeOrder/${orderData._id}`)
                        button.btn.btn-danger أكمل الطلب
  
          
            if (orderData.status != "completed" && x !=0 && orderData.status != "returned" && orderData.status != "canceled")
                .col.mt-4.ltr
                    a(href=`../returnOrder/${orderData._id}`)
                        .btn.btn-success ارجاع الطلب



        - var mobile = 0
        - mobile = (orderData.mobile).slice(-8)

        .row
          .col
            a(href=`/invoicePrint/${orderData._id}`)
              .btn.btn-success.bg-warning.mb-2 اطبع الفاتورة
          .col
            a(aria-label='Chat on WhatsApp' href=`https://wa.me/965${mobile}`)
              .btn.btn-success.bg-warning.mb-2 واتساب فارغ
          .col
            a(aria-label='Chat on WhatsApp' href=`https://wa.me/965${mobile}/?text=تم%20استلام%20طلبك%20من%20شركة ${language.language.ar.title}%0aرقم%20الطلب: %20${orderData.orderNo}%0aالاجمالي:${(total - orderData.discount + orderData.shippingCost).toFixed(3)}د.ك%0aللاطلاع على تفاصيل الطلب:%0a${theData.host}/invoicePrint/${orderData.orderNo}`)
              .btn.btn-success.bg-warning.mb-2 واتساب بالبيانات
